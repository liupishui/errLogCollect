!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e=e||self).errLogCollect=r()}(this,function(){var e=(new Date).getTime();window.addEventListener?window.addEventListener("load",function(){e=(new Date).getTime()-e},!0):window.attachEvent&&(e=(new Date).getTime()-e),document.createElement.bind&&(document.createElement=function(){var e=document.createElement.bind(document);return function(r){var n=e(r);return"script"===r&&(n.crossOrigin="anonymous"),n}}());return function(r){if(r.url){this.getDevices=function(){var e=navigator.userAgent;if(navigator.appVersion,!/AppleWebKit.*Mobile/i.test(navigator.userAgent)&&!/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/.test(navigator.userAgent))return e.indexOf("iPad")>-1?"iPhone":"PC";if(window.location.href.indexOf("?mobile")<0)try{return/iPhone|mac|iPod|iPad/i.test(navigator.userAgent)?"iPhone":"Android"}catch(e){}},this.getBrowserName=function(){var e=navigator.userAgent,r=e.indexOf("Opera")>-1;return r?"Opera":e.indexOf("Firefox")>-1?"FF":e.indexOf("Chrome")>-1?"Chrome":e.indexOf("Safari")>-1?"Safari":e.indexOf("compatible")>-1&&e.indexOf("MSIE")>-1&&!r?"IE":void 0},this.getSystemVersion=function(){var e=window.navigator.userAgent;if(e.indexOf("CPU iPhone OS ")>=0)return e.substring(e.indexOf("CPU iPhone OS ")+14,e.indexOf(" like Mac OS X"));if(e.indexOf("Android ")>=0)return e.substr(e.indexOf("Android ")+8,3);var r=navigator.userAgent,n="Win32"==navigator.platform||"Windows"==navigator.platform,t="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;if(t)return"Mac";if("X11"==navigator.platform&&!n&&!t)return"Unix";if(String(navigator.platform).indexOf("Linux")>-1)return"Linux";if(n){if(r.indexOf("Windows NT 5.0")>-1||r.indexOf("Windows 2000")>-1)return"Win2000";if(r.indexOf("Windows NT 5.1")>-1||r.indexOf("Windows XP")>-1)return"WinXP";if(r.indexOf("Windows NT 5.2")>-1||r.indexOf("Windows 2003")>-1)return"Win2003";if(r.indexOf("Windows NT 6.0")>-1||r.indexOf("Windows Vista")>-1)return"WinVista";if(r.indexOf("Windows NT 6.1")>-1||r.indexOf("Windows 7")>-1)return"Win7";if(r.indexOf("Windows NT 10")>-1||r.indexOf("Windows 10")>-1)return"Win10"}return"other"},this.defaults={rate:1,ua:window.navigator.userAgent,browser:this.getBrowserName(),os:this.getDevices(),osVersion:this.getSystemVersion(),errUrl:window.location.href,host:window.location.host,time:(new Date).getTime(),msg:""};for(var n in r)this.defaults[n]=r[n];this.formatParams=function(e){var r=[];for(var n in e)r.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return r.push(("v="+Math.random()).replace(".","")),r.join("&")},this.ajax=function(r){if(r.data.renderTime=e,(r=r||{}).type=(r.type||"GET").toUpperCase(),r.dataType=r.dataType||"json",navigator.sendBeacon){var n=new FormData;for(var t in r.data)n.append(t,r.data[t]);navigator.sendBeacon(r.url,n)}else{var i=this.formatParams(r.data);if(window.XMLHttpRequest)var o=new XMLHttpRequest;else o=new ActiveXObject("Microsoft.XMLHTTP");"GET"==r.type?(o.open("GET",r.url+"?"+i,!1),o.send(null)):"POST"==r.type&&(o.open("POST",r.url,!1),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(i))}},this.uploadErrors=function(){for(var e in this.resourcesErrors)this.Errors.push(this.resourcesErrors[e]);if(this.RuntimeErrorsEvent.length>0)for(var e in this.RuntimeErrorsEvent)this.Errors.push(this.RuntimeErrorsEvent[e]);else for(var e in this.RuntimeErrors)this.Errors.push(this.RuntimeErrors[e]);var r=[];console.log(this.Errors);for(var e in this.Errors)r.push('[{"type":"'+this.Errors[e].type+'","jsErrorType":"'+this.Errors[e].jsErrorType+'","message":"'+this.Errors[e].message+'","col":"0","line":"0","filename":"'+this.Errors[e].filename+'"}]');this.defaults.msg=r.join("|"),""!=this.defaults.msg&&""!==this.defaults.msg&&this.ajax({url:this.defaults.url,type:"POST",data:this.defaults,dataType:"json"})},this.Errors=[],this.resourcesErrors=[],this.RuntimeErrors=[],this.RuntimeErrorsEvent=[];var t=this,i=function(e){if(Math.random()<t.defaults.rate){if("string"!=typeof e){var r=e.srcElement?e.srcElement:e.target;r.tagName&&t.resourcesErrors.push({type:"resourceError",jsErrorType:r.tagName.toLowerCase(),message:r.outerHTML.toString().replace(/"/g,"'"),colno:0,line:0,filename:r.currentSrc||r.href||r.src||""})}"object"==typeof e&&e.error&&t.RuntimeErrorsEvent.push({type:"runtimeErrors",jsErrorType:e.error.stack.split(":")[0],message:e.error.stack.replace(/\n/g,"->"),colno:e.colno,lineno:e.lineno,filename:e.filename})}};onerrorOld=window.onerror,window.onerror=function(e,r,n){return Math.random()<t.defaults.rate&&t.RuntimeErrors.push({type:"runtimeErrors",jsErrorType:e.split(":")[0],message:e,colno:0,lineno:n,filename:r}),onerrorOld},window.addEventListener?window.addEventListener("error",i,!0):window.attachEvent&&window.attachEvent("onerror",i),window.addEventListener?window.addEventListener("beforeunload",function(){t.uploadErrors.call(t)},!0):window.attachEvent&&window.attachEvent("onbeforeunload",function(){t.uploadErrors.call(t)})}}});
